{% extends 'layout2.html' %}
{% load poll_extras %}

{% block title %}
    پروفایل
{% endblock %}
{% block links %}
    <link rel="stylesheet" href="/static/css/vendor/messages.css">
{% endblock %}
{% block content %}
    <main class="main-wrapper">
        <!-- Start Breadcrumb Area  -->
        <div class="axil-breadcrumb-area">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6 col-md-8">
                        <div class="inner">
                            <ul class="axil-breadcrumb">
                                <li class="axil-breadcrumb-item"><a href="{% url 'home' %}">خانه</a></li>
                                <li class="separator"></li>
                                <li class="axil-breadcrumb-item active" aria-current="page">پروفایل من</li>
                            </ul>
                            <h1 class="title">همه محصولات را کاوش کنید</h1>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-4">
                        <div>
                            <div class="bradcrumb-thumb" id="clock" style="font-size: 2em; text-align: left;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Breadcrumb Area  -->

        <!-- Start My Account Area  -->
        <div class="axil-dashboard-area axil-section-gap">
            <div class="container">
                <div class="axil-dashboard-warp">
                    <div class="axil-dashboard-author">
                        <div class="media">
                            <div class="media-body">
                                <h5 class="title mb-0">سلام، {{ user.first_name }} {{ user.last_name }} ( نام کاربری:
                                    {{ user.username }} )</h5>
                                <span class="joining-date">عضو {{ settings.name }} از {{ user.date_joined|j_day }} {{ user.date_joined|j_month }} {{ user.date_joined|j_year }}</span>
                            </div>
                        </div>
                    </div>
                    {% if messages %}
                        <ul class="messages" style="width: 50%;margin: 70px auto">
                            {% for message in messages %}
                                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
                                    {{ message }}
                                </li>
                            {% endfor %}
                        </ul>
                        </div>
                    {% endif %}
                {% if invalid_email %}
                    <div class="error alert-danger text-center" style="color: red; width: 50%; margin: 30px auto">
                        ایمیل وارد شده نامعتبر است.
                    </div>
                {% endif %}
                <div class="row">
                    <div class="col-xl-3 col-md-4">
                        <aside class="axil-dashboard-aside">
                            <nav class="axil-dashboard-nav">
                                <div class="nav nav-tabs" role="tablist">
                                    <a class="nav-item nav-link active" data-bs-toggle="tab" href="#nav-dashboard"
                                       role="tab" aria-selected="true"><i class="fas fa-th-large"></i>داشبورد</a>
                                    <a class="nav-item nav-link" data-bs-toggle="tab" href="#nav-orders" role="tab"
                                       aria-selected="false"><i class="fas fa-shopping-basket"></i>سفارشات</a>
                                    <a class="nav-item nav-link" data-bs-toggle="tab" href="#nav-downloads"
                                       role="tab"
                                       aria-selected="false"><i class="fas fa-user"></i>
                                        تغییر رمز عبور</a>
                                    <a class="nav-item nav-link" data-bs-toggle="tab" href="#nav-address" role="tab"
                                       aria-selected="false"><i class="fas fa-home"></i>آدرس ها</a>
                                    <a class="nav-item nav-link" data-bs-toggle="tab" href="#nav-account" role="tab"
                                       aria-selected="false"><i class="fas fa-user"></i>جزئیات پروفایل</a>
                                    <a class="nav-item nav-link" href="{% url 'logout' %}"><i
                                            class="fal fa-sign-out"></i>خروج</a>
                                </div>
                            </nav>
                        </aside>
                    </div>
                    <div class="col-xl-9 col-md-8">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="nav-dashboard" role="tabpanel">
                                <div class="axil-dashboard-overview">
                                    <div class="welcome-text">سلام {{ user.first_name }} {{ user.last_name }}
                                        ({{ user.first_name }}
                                        {{ user.last_name }} <span>نیستید؟</span>
                                        <a
                                                href="{% url 'logout' %}">خروج</a>)
                                    </div>
                                    <p>از داشبورد حساب خود می توانید سفارشات اخیر خود را مشاهده کنید ، آدرس حمل
                                        و نقل را مدیریت کرده و رمز عبور و جزئیات حساب خود را ویرایش
                                        کنید.</p>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="nav-orders" role="tabpanel">
                                <div class="axil-dashboard-order">
                                    <div class="table-responsive">
                                        <table class="table">
                                            {% if carts %}
                                                <thead>
                                                <tr>
                                                    <th scope="col">سفارش</th>
                                                    <th scope="col">تاریخ</th>
                                                    <th scope="col">وضعیت</th>
                                                    <th scope="col">جمع کل</th>
                                                    <th scope="col">عملیات</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% for cart in carts %}
                                                    <tr>
                                                        <th scope="row">#{{ cart.id }}</th>
                                                        <td>{{ cart.payment_date|j_date }}</td>
                                                        <td>{% if cart.delivery %}
                                                            تحویل شده
                                                        {% elif cart.process %}
                                                            درحال پردازش
                                                        {% else %}
                                                            منتظر تایید توسط ادمین
                                                        {% endif %} </td>
                                                        <td>{{ cart.total_price|digits }} تومان
                                                            برای {{ cart.detail_count }} محصول
                                                        </td>
                                                        <td><a href="#" class="axil-btn view-btn">نمایش</a></td>
                                                    </tr>
                                                {% endfor %}
                                                </tbody>
                                            {% else %}
                                                <div class="alert alert-danger text-center"
                                                     style="width: 50%;margin: 70px auto">هنوز هیچ خریدی نداشته اید.
                                                    <a href="{% url 'product-list' %}">خرید کنید.</a>
                                                </div>
                                            {% endif %}
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="nav-downloads" role="tabpanel">
                                <div class="axil-dashboard-order">
                                    <form name="password-change-form" class="account-details-form" method="post">
                                        {% csrf_token %}
                                        <h5 class="title">تغییر رمز عبور</h5>
                                        <div class="form-group">
                                            <label>رمز عبور فعلی</label>
                                            <input name="old-password" type="password" class="form-control"
                                                   value="">
                                        </div>
                                        <div class="form-group">
                                            <label>رمز عبور جدید</label>
                                            <input name="new-password" type="password" class="form-control">
                                        </div>
                                        <div class="form-group">
                                            <label>تکرار رمز عبور جدید</label>
                                            <input name="re-new-password" type="password" class="form-control">
                                        </div>
                                        <div class="form-group mb--0">
                                            <input type="submit" class="axil-btn" name="password-change-form"
                                                   value="ذخیره">
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="nav-address" role="tabpanel">
                                <div class="axil-dashboard-address">
                                    <p style="color: #610404" class="notice-text">آدرس زیر به طور پیش فرض در صفحه پرداخت استفاده می شود.
                                       ( می توانید اطلاعات آدرس خود را در بخش جزئیات پروفایل ویرایش کنید )</p>
                                    <div class="row row--30">
                                        <div class="col-lg-12">
                                            <div class="address-info mb--40">
                                                <div class="addrss-header d-flex align-items-center justify-content-between">
                                                    <h4 class="title mb-0">آدرس </h4>
{#                                                    <a href="#" class="address-edit"><i class="far fa-edit"></i></a>#}
                                                </div>
                                                <ul class="address-details">
                                                    <li>نام: {{ user.first_name }} {{ user.last_name }}</li>
                                                    <li>ایمیل: {{ user.email }}</li>
                                                    <li>شماره موبایل: {{ user.phone }}</li>
                                                    {% if user.address %}
                                                        <li class="mt--30">{{ user.province }}، {{ user.address }}</li>
                                                    {% else %}
                                                        <li style="color: red" class="mt--30">لطفا استان و جزئیات
                                                            آدرس خود را در بخش
                                                            جزئیات پروفایل تکمیل نمایید.
                                                        </li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="nav-account" role="tabpanel">
                                <div class="col-lg-9">
                                    <div class="axil-dashboard-account">
                                        <form name="user-info-form" class="account-details-form" method="post">
                                            {% csrf_token %}
                                            <div class="row">
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <label>نام</label>
                                                        <input name="first-name" type="text" class="form-control"
                                                               value="{{ user.first_name }}">
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <label>نام خانوادگی</label>
                                                        <input name="last-name" type="text" class="form-control"
                                                               value="{{ user.last_name }}">
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        {% if user.email %}
                                                            <label>ایمیل</label>
                                                            <input name="email" type="email" class="form-control"
                                                                   value="{{ user.email }}">
                                                        {% else %}
                                                            <label>ایمیل</label>
                                                            <input name="email" type="email" class="form-control"
                                                                   value="">
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="col-lg-6"
                                                     style="text-align: right; justify-content: center; margin: 10px auto">
                                                    <label>شماره موبایل:</label>
                                                    <label>{{ user.phone }}</label>
                                                </div>
                                                <div class="col-12">
                                                    <div class="form-group mb--40">
                                                        <label>استان</label>
                                                        <select class="select2" name="province">
                                                            {% if user.province %}
                                                                <option value="{{ user.province }}">{{ user.province }}</option>
                                                            {% else %}
                                                                <option value="انتخاب کنید">انتخاب کنید</option>
                                                            {% endif %}
                                                            <option value="آذربایجان شرقی">آذربایجان شرقی</option>
                                                            <option value="آذربایجان غربی">آذربایجان غربی</option>
                                                            <option value="اردبیل">اردبیل</option>
                                                            <option value="اصفهان">اصفهان</option>
                                                            <option value="البرز">البرز</option>
                                                            <option value="ایلام">ایلام</option>
                                                            <option value="بوشهر">بوشهر</option>
                                                            <option value="تهران">تهران</option>
                                                            <option value="چهارمحال و بختیاری">چهارمحال و بختیاری
                                                            </option>
                                                            <option value="خراسان جنوبی">خراسان جنوبی</option>
                                                            <option value="خراسان رضوی">خراسان رضوی</option>
                                                            <option value="خراسان شمالی">خراسان شمالی</option>
                                                            <option value="خوزستان">خوزستان</option>
                                                            <option value="زنجان">زنجان</option>
                                                            <option value="سمنان">سمنان</option>
                                                            <option value="سیستان و بلوچستان">سیستان و بلوچستان
                                                            </option>
                                                            <option value="فارس">فارس</option>
                                                            <option value="قزوین">قزوین</option>
                                                            <option value="قم">قم</option>
                                                            <option value="کردستان">کردستان</option>
                                                            <option value="کرمان">کرمان</option>
                                                            <option value="کرمانشاه">کرمانشاه</option>
                                                            <option value="کهگیلویه و بویراحمد">کهگیلویه و
                                                                بویراحمد
                                                            </option>
                                                            <option value="گلستان">گلستان</option>
                                                            <option value="گیلان">گیلان</option>
                                                            <option value="لرستان">لرستان</option>
                                                            <option value="مازندران">مازندران</option>
                                                            <option value="مرکزی">مرکزی</option>
                                                            <option value="هرمزگان">هرمزگان</option>
                                                            <option value="همدان">همدان</option>
                                                            <option value="یزد">یزد</option>
                                                        </select>
                                                        <p class="b3 mt--10">در بخش آدرس حتما نام شهر خود را در
                                                            ابتدا وارد نموده و سپس ادامه آدرس را وارد کنید</p>
                                                    </div>
                                                </div>
                                                <div class="col-lg-12">
                                                    {% if user.address is None %}
                                                        <div class="form-group">
                                                            <label>آدرس</label>
                                                            <input name="address" type="text" class="form-control"
                                                                   value="">
                                                        </div>
                                                    {% else %}
                                                        <div class="form-group">
                                                            <label>آدرس</label>
                                                            <input name="address" type="text" class="form-control"
                                                                   value="{{ user.address }}">
                                                        </div>
                                                    {% endif %}
                                                </div>
                                                <div class="form-group mb--0">
                                                    <input type="submit" class="axil-btn" name="user-info-form"
                                                           value="ذخیره">
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- End My Account Area  -->
    </main>
    <div class="service-area">
        <div class="container">
            <div class="row row-cols-xl-4 row-cols-sm-2 row-cols-1 row--20">
                <div class="col">
                    <div class="service-box service-style-2">
                        <div class="icon">
                            <img src="/static/images/icons/service1.png" alt="Service">
                        </div>
                        <div class="content">
                            <h6 class="title">ارسال سریع و ایمن</h6>
                            <p>برای تمامی سفارشات.</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="service-box service-style-2">
                        <div class="icon">
                            <img src="/static/images/icons/service2.png" alt="Service">
                        </div>
                        <div class="content">
                            <h6 class="title">گارانتی بازگشت وجه</h6>
                            <p>حتی بیشتر از 7 روز.</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="service-box service-style-2">
                        <div class="icon">
                            <img src="/static/images/icons/service3.png" alt="Service">
                        </div>
                        <div class="content">
                            <h6 class="title">مرجوعی طی 24 ساعت</h6>
                            <p>بدون سوال.</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="service-box service-style-2">
                        <div class="icon">
                            <img src="/static/images/icons/service4.png" alt="Service">
                        </div>
                        <div class="content">
                            <h6 class="title">پشتیبانی کامل</h6>
                            <p>24/7 پشتیبان آنلاین است.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script>
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
        }

        setInterval(updateClock, 1000);
        updateClock();
    </script>
{% endblock %}